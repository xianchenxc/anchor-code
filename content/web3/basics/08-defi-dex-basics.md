---
id: web3-defi-dex-basics
category: Web3
subcategory: 基础概念
type: knowledge
title: DeFi 与 DEX 基础
---

在 DeFi 世界中，去中心化交易所（DEX）和流动性池是最核心的基础设施之一。

## AMM 与恒定乘积公式

很多 DEX（如 Uniswap V2）的定价机制基于 AMM（自动做市商）：

- 假设有一对代币池：`Token A` 和 `Token B`
- 池子中当前储备量为：`x` 和 `y`
- 满足近似恒定乘积公式：`x * y = k`

当用户用 A 换 B 时：

- 向池子增加一定数量的 A（Δx）
- 从池子取出对应数量的 B（Δy）
- 交易前后有：`(x + Δx) * (y - Δy) ≈ k`

由于池子中代币比例发生变化，价格也会随之变动，这也是**价格影响（Price Impact）**产生的根源。

## 流动性池与 LP Token

DEX 并没有传统意义上的挂单簿，而是使用「流动性池」：

- 用户可以向池子中存入一对代币（例如 ETH/USDC），成为「流动性提供者（LP）」
- 作为回报，LP 会获得：
  - 代表其份额的 **LP Token**
  - 由交易手续费按比例分配的收益

前端通常需要展示：

- 池子总流动性（TVL）
- 当前价格（由池子内资产比例决定）
- 用户持有的 LP 数量与价值

## 无常损失（Impermanent Loss）

当池子内两种代币的价格发生变化时：

- LP 的资产组合会自动被「再平衡」
- 相比单纯持有两种代币，可能出现收益减少的情况

这种差额被称为**无常损失**：

- 如果价格最终回到初始状态，无常损失会消失
- 如果价格永久偏离，无常损失就变成了「永久损失」

前端在展示 DeFi 产品时，通常需要：

- 对新手解释无常损失风险
- 提示高波动交易对的风险更大

## Swap、Add/Remove Liquidity 的基本流程

1. **Swap（代币兑换）**
   - 选择输入/输出代币
   - 输入数量
   - 获取报价（输出数量、价格影响、滑点）
   - 检查余额与批准（Approval）
   - 构建并发送交易

2. **Add Liquidity（添加流动性）**
   - 选择交易对
   - 输入要提供的两种代币数量
   - 检查比例是否合理（有些池要求固定比例）
   - 显示预估获得的 LP Token 数量
   - 发送添加流动性的交易

3. **Remove Liquidity（移除流动性）**
   - 选择要移除的 LP Token 数量或百分比
   - 预估可获得的两种代币数量
   - 显示价格影响与手续费收益
   - 发送移除流动性的交易

## 前端开发关注点

- 实时价格与报价展示
- 流动性池数据的获取与更新（RPC 或索引服务）
- 用户持仓、收益的可视化（图表、统计）
- 风险提示（无常损失、滑点、价格影响等）

本篇打好 DeFi 与 DEX 的基础，后续在滑点、价格影响、流动性池细节、Swap 流程等 topics 中会进一步展开。

